# AI Image Detector: Detecci칩n Forense de Im치genes Generadas por IA

Este proyecto implementa un m칠todo avanzado de detecci칩n de im치genes sint칠ticas basado en el an치lisis de **huellas 칩pticas y estad칤sticas de gradientes**.

## 游댧 Fundamento F칤sico y Matem치tico

El m칠todo para distinguir una imagen generada por IA de una fotograf칤a real se basa en el **an치lisis de cambios pixel a pixel**, conocidos como **gradientes**.

### 1. La Firma F칤sica de lo Real

Las fotograf칤as reales contienen patrones de gradiente formados por procesos f칤sicos inherentes a la captura de luz:

- **Procesos 칍pticos**: La luz pasa a trav칠s de sistemas de lentes que introducen aberraciones microsc칩picas y propiedades de difracci칩n consistentes.
- **Sensores Electr칩nicos**: Los sensores CMOS/CCD imprimen una "firma de ruido" (PRNU - Photo-Response Non-Uniformity) y correlaciones espec칤ficas entre p칤xeles vecinos debido al proceso de demosaicing (interpolaci칩n de color).

Estas imperfecciones f칤sicas dejan una **"firma 칩ptica"** constante y estad칤sticamente predecible en los gradientes de la imagen.

### 2. La Naturaleza de la Generaci칩n Artificial

Los modelos de difusi칩n (Stable Diffusion, Midjourney, DALL-E) no capturan luz; construyen im치genes a partir de ruido aleatorio mediante procesos iterativos de eliminaci칩n de ruido (_denoising_).

- Aunque visualmente imitan la realidad, **carecen de la coherencia f칤sica de bajo nivel** de una c치mara real.
- Sus gradientes, aunque parezcan normales a simple vista, difieren estad칤sticamente porque no provienen de un proceso 칩ptico natural, sino de una aproximaci칩n matem치tica.

### 3. El M칠todo: Covarianza de Gradientes y PCA

Para detectar estas diferencias invisibles, utilizamos un enfoque estad칤stico robusto:

1.  **C치lculo de Gradientes**: Calculamos las matrices de gradiente horizontal ($G_x$) y vertical ($G_y$) para analizar las transiciones de luminancia en cada p칤xel.
2.  **Matriz de Covarianza**: Construimos la matriz de covarianza $C$ de estos gradientes.
    $$C = \frac{1}{N} \sum_{i=1}^{N} (\nabla I_i - \mu)(\nabla I_i - \mu)^T$$
3.  **An치lisis de Componentes Principales (PCA)**: Al extraer los **autovalores (eigenvalues)** $\lambda_1, \lambda_2$ de esta matriz, estamos realizando efectivamente un **PCA** sobre la distribuci칩n local de los gradientes.
    - Estos autovalores describen la forma del elipsoide que mejor ajusta la dispersi칩n de los gradientes.
    - **Im치genes Reales**: Tienden a agruparse en una regi칩n espec칤fica del espacio de autovalores, reflejando correlaciones naturales fuertes.
    - **Im치genes IA**: Se dispersan en una regi칩n diferente, a menudo mostrando anisotrop칤a anormal o falta de correlaci칩n fina.

Al examinar miles de gradientes con esta t칠cnica, los dos tipos de im치genes **se separan claramente en clusters distintos**. Nuestro clasificador (Random Forest) aprende autom치ticamente la frontera 칩ptima de decisi칩n entre estos clusters bas치ndose en las caracter칤sticas extra칤das ($\lambda_1, \lambda_2$, anistrop칤a, entrop칤a, etc.).

---

## 游닄 Referencias Bibliogr치ficas

Este m칠todo se inspira y fundamenta en la literatura cient칤fica sobre an치lisis forense de im치genes y estad칤sticas de im치genes naturales:

1.  **Natural Image Statistics**:
    - _Ruderman, D. L. (1994). The statistics of natural images. Network: Computation in Neural Systems._ (Base sobre por qu칠 las im치genes naturales tienen estad칤sticas invariantes).
2.  **Gradient Analysis for Forensics**:
    - _Mahdian, B., & Saic, S. (2009). Using noise inconsistencies for blind image forgery detection. Image and Vision Computing._
3.  **Sensor Noise & PRNU**:
    - _Chen, M., et al. (2008). Determining Image Origin by the Source Camera ID._ (Sobre la firma 칰nica de los sensores).
4.  **AI Detection via Frequency/Gradients**:
    - _Frank, J., et al. (2020). Leveraging Frequency Analysis for Deep Fake Image Recognition. ICML._
    - _Corvi, R., et al. (2023). On the detection of synthetic images generated by diffusion models. ICASSP._

---

## Estructura del Proyecto

- **src/ai_detector**: L칩gica del n칰cleo y extracci칩n de caracter칤sticas (Gradiente, DFT, DCT, Color).
- **src/app**: Aplicaci칩n FastAPI y Servicios.
- **notebooks/**: Notebooks de Jupyter para demostraci칩n y an치lisis detallado.
- **scripts/**: Scripts CLI para procesamiento por lotes.
- **data/**: Almacenamiento de datos (im치genes raw, procesadas).

## Instalaci칩n

```bash
pip install -r requirements.txt
pip install -e .
```

## Uso

### Ejecutar API (con auto-entrenamiento)

La API buscar치 im치genes en `data/train/real` y `data/train/fake` para entrenarse al inicio.

```bash
make run-api
# O manualmente: uvicorn app.main:app --reload --app-dir src --host 0.0.0.0
```

### Script de Clasificaci칩n de Carpeta

```bash
python scripts/classify_folder.py data/raw
```

### Notebooks de An치lisis

Abre `notebooks/01_gradient_covariance_analysis.ipynb` para ver el c칩digo paso a paso y las visualizaciones interactivas de los gradientes y elipses de covarianza.
